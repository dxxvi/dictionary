<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd">

    <context:component-scan base-package="home"/>

    <!--
        mvc:annotation-driven is needed to use @ResponseBody, @RequestBody ... and the content-negotiation-manager is
        needed so that we can write
        @RequestMapping(value="/accounts", produces={"application/json", "application/xml"})
    -->
    <mvc:annotation-driven content-negotiation-manager="contentNegotiationManagerFactoryBean">
        <mvc:async-support default-timeout="19" task-executor="asyncTaskExecutor"/>
    </mvc:annotation-driven>

    <bean id="asyncTaskExecutor" class="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor"
          p:corePoolSize="4" p:maxPoolSize="19" p:queueCapacity="82"/>

    <!--
         http://spring.io/blog/2013/05/11/content-negotiation-using-spring-mvc
         To figure out what format the response should be in, Spring checks these things in this order:
         - a path extension in the url: http://server/app/spring-mapping/account.html
         - a url parameter (defined by the parameterName below) like
           http://server/app/spring-mapping/account?mediaType=json
         - the Accept http header
    -->
    <bean id="contentNegotiationManagerFactoryBean"
          class="org.springframework.web.accept.ContentNegotiationManagerFactoryBean"
          p:defaultContentType="application/xml"
          p:favorPathExtension="true"
          p:parameterName="mediaType"
          p:ignoreAcceptHeader="false"
          p:useJaf="false">
        <property name="mediaTypes">
            <map>
                <entry key="json" value="application/json"/>
                <entry key="xml"  value="application/xml"/>
            </map>
        </property>
    </bean>

    <bean class="org.springframework.web.servlet.view.ContentNegotiatingViewResolver"
          p:contentNegotiationManager-ref="contentNegotiationManagerFactoryBean">
        <property name="viewResolvers">
            <list>
                <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver" p:prefix="/WEB-INF/jsp/"
                      p:suffix=".jsp"/>
            </list>
        </property>
        <property name="defaultViews">
            <list>
                <bean class="org.springframework.web.servlet.view.json.MappingJackson2JsonView"/>
            </list>
        </property>
    </bean>
</beans>